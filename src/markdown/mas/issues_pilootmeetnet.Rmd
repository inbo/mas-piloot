---
title: "Lijst issues met steekproef pilootmeetnet"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
renv::restore()
library(knitr)
library(here)
opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)
opts_knit$set(root.dir = here::here())
library(tidyverse)
library(sf)
```


# Inlezen data

We lezen de KML-file in. In de attributentabel staan issues waarmee we moeten rekening houden in volgende steekproeftrekkingen. Het inlezen van deze data is niet triviaal. Zie:  
https://github.com/r-spatial/sf/issues/499  
https://gis.stackexchange.com/questions/301336/extracting-non-spatial-data-from-imported-kml-file-using-r  

```{r}
# Create data path
data_path <- here("data", "mas")

# Read data
issue_list_raw <- st_read(paste(data_path, "MAS punten 2022 per teller.kml", 
                                sep = "/"))

# Parse to table
issue_list <- issue_list_raw %>%
  st_drop_geometry() %>%
  mutate(
    Name = readr::parse_character(Name),
    Name = trimws(Name, whitespace = "[\\h\\v]"),
    Name = trimws(Name),
    Description = str_remove_all(Description, "^description:\\s.*?<br>")) %>%
  separate(col = Description,
           into = c("beschrijving",
                    "beslissing",
                    "vervanging_id",
                    "pointid",
                    "Naam",
                    "openheid_sbp",
                    "batch",
                    "sample_order",
                    "plotid",
                    "plotnummer",
                    "teller_2021",
                    "wie"),
           sep = "(<br>)+") %>%
  mutate(across(beschrijving:wie, ~str_extract(., "(?<=:\\s).+")))
```


# Hoe zien de data eruit?

```{r}
glimpse(issue_list)
```

- name: tellerscode van de waarnemer
- beschrijving:
    - OK = punt kan geteld worden
    - andere tekstuele opmerking beschrijft waarom (beter) niet
- beslissing: omzetting van beschrijving naar concrete beslissingsboom
    - behouden: dit punt wordt geteld
    - vervangen door bestaand: een oud MAS punt  (uit vorige programma) kan verdergezet worden omdat het centrum van het nieuw punt in de telcirkel van het oude MAS punt valt
    - vervangen door reserve: dit punt wordt vervangen door een resevepunt omdat het niet voldoet aan onze voorwaarden
- vervanging_id: id van het punt waardoor het vervangen wordt. Dat reserve punt kan dan op zijn beurt ook nog vervangen worden (indien afgekeurd) door een ander reserve punt.
- rest van de kolommen zijn eigenschappen/klassen van dat punt

