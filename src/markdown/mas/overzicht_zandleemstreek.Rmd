---
title: "Overzicht zandleemstreek"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
renv::restore()
library(knitr)
library(here)
opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)
opts_knit$set(root.dir = here::here())

library(tidyverse)
library(sf)
library(mapview)

mbag_dir <- here()
```

# Doel

Overzicht van de zandleemstreek geven om steekproefgebied af te bakenen.

# Kaartlagen

```{r}
landbouwstreken <- read_sf(here("data", "landbouwstreken", "Lbstrbel.shp")) %>%
  st_transform(crs = 31370)

akkervogelgebieden <- read_sf(here("data", "bo_vlm", 
                                   "akkervogelgebieden2022.shp")) %>%
  st_transform(crs = 31370)

vlaanderen <- read_sf("S:/Vlaanderen/Grenzen/Administratief/Vlaanderen.shp") %>%
  st_transform(crs = 31370)
```

```{r}
ggplot() +
  geom_sf(data = landbouwstreken, aes(fill = NAAM)) +
  geom_sf(data = akkervogelgebieden, fill = "black", colour = alpha("black", 0)) +
  geom_sf(data = vlaanderen, fill = alpha("black", 0), colour = "red", size = 1.5) +
  labs(fill = "Landbouwstreek")
```

# Selectie doelgebied

```{r}
zandleem_vlaanderen <- st_intersection(landbouwstreken, vlaanderen) %>%
  filter(NAAM == "Zandleemstreek")

akkervogelgebieden_zandleem <- st_intersection(akkervogelgebieden, 
                                               zandleem_vlaanderen)
```

```{r}
mapview(zandleem_vlaanderen, col.regions = "red") + 
  mapview(akkervogelgebieden_zandleem)
```

# Probleem met osm extract

>The OpenStreetMap map for Belgium is incomplete, some small pieces are missing.
><https://download.geofabrik.de/europe/belgium.html#>

>In the documentation I read: "The boundaries usually follow country borders, but occasionally we take liberties and include a litte more of a neighbouring country if this greatly simplifies the polygon."
>But this is not the case here: 
>approx. coord.: 50.793232, 3.115215 and 50.782217, 3.104937

>This means that when I want to extract information from these regions or a polygon containing these regions, not the region of Belgium is downloaded but the entire European map.
>This map is very large and way too large for my intentions.
>Belgium is only a small country so it is a bit silly to have to download the entire map of Europe.  
  
  
Voorlopige oplossing:  
Maak intersectie met polygoon van osm website en negatieve buffer.

```{r}
belgium <- st_read("C:/Users/ward_langeraert/Downloads/belgium.kml", 
                   quiet = TRUE) %>% 
  st_zm(drop = TRUE, what = "ZM") %>% 
  st_transform(31370)

intersect_osm <- st_intersection(zandleem_vlaanderen, belgium)

osmextract::oe_match(intersect_osm %>% st_buffer(-0.001))
```
