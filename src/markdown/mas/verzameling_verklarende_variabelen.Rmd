---
title: "Verzameling verklarende variabelen"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
bibliography: references.json
---

```{r setup, include=FALSE}
renv::restore()

# Set up
library(knitr)
library(here)
opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)
opts_knit$set(root.dir = here())

conflicted::conflicts_prefer(dplyr::filter)
conflicted::conflicts_prefer(dplyr::select)

# Packages
library(tidyverse)
library(INBOtheme)

library(sf)
library(terra)
library(nngeo)
library(lubridate)

# Source
mbag_dir <- here()
source(file.path("src", "R", "berekening_hulpvariabelen.R"))
source(file.path("src", "R", "geocomputations.R"))
```

# Kadering

We willen een evaluatie van het effect van de maatregelen die getroffen worden binnen het agrarisch natuurbeleid op de trends en het voorkomen van akkervogels.
Dit per soort, en op plotniveau (telcirkelniveau).

Dit document geeft een overzicht van de verklarende variabelen die we gaan gebruiken in de modellen die we gaan fitten om bovenstaande te onderzoeken.

1.  Welke variabelen?
2.  Welk datatype (continu, categorisch, proporties, compositioneel ...)?
3.  Waar verzameld?
4.  Hoe verzameld?
5.  Hoe berekend?
6.  Verdere bedenkingen/opmerkingen. Zijn er bijvoorbeeld transformaties nodig?

# Inlezen data

We moeten de variabelen bepalen/berekenen op plotniveau (= telcirkelniveau).
We hebben dus een lijst nodig met alle plots die geteld zijn met coÃ¶rdinaten.

De dataframe `telpunten_2018_2021` bevat alle MAS telpunten die in de periode 2018-2021 zijn doorgegeven aan SOVON.
Het is echter niet zo dat al deze telpunten in elk jaar geteld zijn.
Het kan zelfs zijn dat een telpunt uit deze lijst in geen enkel jaar werd geteld (= helemaal niet bezocht geweest).
Het kan ook zijn dat het wel bezocht is geweest, maar dat er geen waarnemingen zijn.

> We moeten navragen welke punten bezocht zijn in 2018-2021.
> Nu weten we enkel dat een plot bezocht is als er ook effectief waarnemingen waren, maar we hebben geen idee in welke plots er nultellingen zijn geweest.

```{r}
Sys.setenv("PROJ_NETWORK" = "ON")
sf_proj_network(TRUE)
pipelines <- sf_proj_pipelines("EPSG:28992", "EPSG:31370")

# We select the pipeline with lowest accuracy (< 0.02), by filtering on accuracy.
# If the grids are installed, this should match the first line of the pipelines object.
chosen_pipeline_definition <- pipelines %>%
  filter(accuracy < 0.02) %>% 
  pull(definition)

telpunten_2018_2021_raw <- read_sf(
  here("data", "mas",
       "avimap_514_0_MAS_Werkgroep_Grauwe_Kiekendief_Belgi__telpunten_xy.shp")) %>%
  rename(teller_2021 = teller) %>%
  mutate(
    regio = ifelse(is.na(regio), "Vlaanderen - Bilzen", regio),
    type_teller_2021 = case_when(
      teller_2021 %in% c("WVNT00", "JJNN16", "NOVN00") |
        regio == "Vlaanderen - Leefdaal" ~ "professioneel",
      is.na(teller_2021) &
        regio != "Vlaanderen - Leefdaal" ~ "niet geteld in 2021",
      TRUE ~ "vrijwilliger"))

telpunten_2018_2021_amersfoort <- telpunten_2018_2021_raw %>%
  st_drop_geometry() %>%
  st_as_sf(coords = c("st_x", "st_y"), crs = 28992)

telpunten_2018_2021 <- st_transform(
  st_geometry(telpunten_2018_2021_amersfoort), "EPSG:31370",
  pipeline = chosen_pipeline_definition) %>% 
  st_sf(st_drop_geometry(telpunten_2018_2021_raw), geometry = .) %>% 
  as_tibble %>% 
  st_as_sf %>%
  mutate(regio = gsub("Vlaanderen - ", "", regio),
         regio = ifelse(regio == "Leemstreek", "Oostelijke leemstreek", regio),
         regio = ifelse(regio == "Bilzen", "Oostelijke leemstreek", regio))

design_2018_2021 <- telpunten_2018_2021 %>%
  select(plotnaam = naam)
```

Voor 2022 kennen we alle telpunten die geteld/bezocht moesten worden.
Wel zijn de locaties in 2022 verkeerd voor VL plots.
Dit zijn reeds bestaande plots en zitten dus al in de lijst van 2018-2021.
We selecteren voor 2022 dus enkel de nieuwe plots.

```{r}
design_2022_raw <- read_csv(here(
    "data",
    "processed",
    "steekproef_piloot_avimap.csv")) %>%
  select(plotnaam = definitief_punt,
         regio,
         stratum,
         X, Y) %>%
  mutate(openheid = ifelse(grepl("HOL", stratum), "HOL", "OL"),
         sbp = ifelse(grepl("binnen", stratum), "binnen", "buiten"),
         stratum = gsub("L\\s{1}", "L\\\n", stratum),
         jaar = 2022L) %>%
  st_as_sf(coords = c("X", "Y"), crs = 31370)

design_2022 <- design_2022_raw %>%
  filter(!grepl("^VL", plotnaam)) %>%
  select(plotnaam)
```

Finaal voegen we alles samen.
We behouden enkel plots binnen de perimeters van de pilootstudie: De Moeren en Oostelijke leemstreek.

```{r}
perimeters <- read_sf(
  here("data", "processed", "piloot_perimeters.gpkg"))

telpunten_2018_2022 <- bind_rows(design_2018_2021, design_2022) %>%
  st_intersection(perimeters) %>%
  select(pointid = plotnaam, regio = Naam)
```

In totaal gaat het om `r nrow(telpunten_2018_2022)` telpunten.
`r nrow(filter(telpunten_2018_2022, regio == "De Moeren"))` in De Moeren en `r nrow(filter(telpunten_2018_2022, regio == "Oostelijke leemstreek"))` in de Oostelijke leemstreek.

```{r}
ggplot() +
  geom_sf(data = perimeters, colour = "firebrick") +
  geom_sf(data = telpunten_2018_2022, size = 0.5)
```

Ook gaan we er voorlopig van uit dat elke plot in elk jaar geteld is.
Beter voorlopig te veel variabelen berekenen en achteraf filteren dan te weinig.

```{r}
jaar <- 2018:2022
telpunten_2018_2022_df <- merge(telpunten_2018_2022, as.data.frame(jaar))
```

# Verklarende variabelen van prioritair belang

## Oppervlakte-aandeel beheerovereenkomsten

### Beschrijving

Het aandeel oppervlakte aan beheerovereenkomsten binnen de telcirkel.

Indeling voor niet-productieve gewassen/beheerovereenkomsten (instrumenten):

-   soortbeschermingsmaatregelen
    -   perceelsniveau
    -   randen
-   erosiemaatregelen
-   bufferstroken

Voor de steekproeftrekking zijn vooral de oppervlakte aan soortbeschermingsmaatregelen van belang.
Eventueel verder opgesplitst in winter-, zomer- en jaarrondmaatregelen.

### Welk datatype?

Continue variabele.
Percentage tussen 0 en 100.

### Waar verzameld?

??

`BO_2022_VLM_EXTERN.shp`

### Hoe verzameld?

??

`BO_2022_VLM_EXTERN.shp`

### Hoe berekend?

Elke overeenkomst is een polygoon met informatie over begin en einde van de beheerovereenkomst.
Start is steeds op 1 januari en stop is steeds op 31 december.
We filteren dus telkens de punten per jaar en we filteren de beheerovereenkomsten zodat ze reeds in werking waren in dat jaar.
Daarna gebruiken we de `add_bo_to_frame()` functie om de proporties per telcirkel te berekenen.

```{r}
add_bo_by_year <- function(punten_df, path_bo) {
  # Read in bo layer and calculate start and stop year
  bo_layer <- read_bo(path = bo_file_2022)
  bo_layer2 <- bo_layer %>% 
    mutate(startjaar = year(START), 
           stopjaar = year(STOP))
  
  # Loop over years
  years <- unique(punten_df$jaar)
  out_list <- vector(mode = "list", length = length(years))
  
  for (i in seq_along(years)) {
    year <- years[i]
    
    # Filter by year
    punten_df_year <- punten_df %>% filter(jaar == year)
    bo_layer_year <- bo_layer2 %>% 
      filter(startjaar <= year & stopjaar >= year)
    
    out_df_year <- add_bo_to_frame(punten_df = punten_df_year, 
                                   bo_layer = bo_layer_year)
    
    out_list[[i]] <- out_df_year %>% mutate(area_prop_sb = area_prop_sb * 100)
  }
  
  return(do.call(rbind.data.frame, out_list))
}
```

```{r}
# Path to bo file
bo_file_2022 <- path_to_bo(jaar = 2022)

# Add proportion bo per year
telpunten_2018_2022_bo <- add_bo_by_year(telpunten_2018_2022_df, bo_file_2022)
```

### Visualisatie

```{r}
telpunten_2018_2022_bo %>%
  ggplot() +
    geom_histogram(aes(x = area_prop_sb)) +
    labs(
      title = "Oppervlakte-aandeel soortbeschermingsmaatregelen",
      x = "Oppervlakte-aandeel (%)",
      y = "Aantal telpunten") +
    facet_wrap(~jaar)
```

### Opmerkingen

-   In percentage of proportie?

## Oppervlakte-aandeel hoofdteelten {#opp-hfdtlt}

### Beschrijving

Het aandeel oppervlakte aan verschillende hoofdteelten binnen de telcirkel.
Gegroepeerd volgens gewasgroep.

### Welk datatype?

Continu, compositionele proporties.

### Waar verzameld?

Belangrijkste teelten 2018-2021:\
<https://www.vlaanderen.be/datavindplaats/catalogus/landbouwgebruikspercelen-lv-2018>\
<https://www.vlaanderen.be/datavindplaats/catalogus/landbouwgebruikspercelen-lv-2019>\
<https://www.vlaanderen.be/datavindplaats/catalogus/landbouwgebruikspercelen-lv-2020>\
<https://www.vlaanderen.be/datavindplaats/catalogus/landbouwgebruikspercelen-lv-2021>

Belangrijkste teelten in 2022:\
<https://landbouwcijfers.vlaanderen.be/open-geodata-landbouwgebruikspercelen>\
Voorlopige kaart.
Finale kaart wordt eind april gepubliceerd (?).

### Hoe verzameld?

Download van urls.

Omzetten naar .parquet file.
Bijvoorbeeld voor 2019:

    file <- sf::read_sf(file.path(mbag_dir, "data", "landbouwgebruikspercelen", "Shapefile",
                                  "Lbgbrprc19.shp"), query = NA)

    sfarrow::st_write_parquet(obj = file, 
                              dsn = file.path(mbag_dir, "data", "landbouwgebruikspercelen", "parquet",
                                              "lbgbrprc2019.parquet"), chunk_size = 10000)

### Hoe berekend?

Voor elk jaar hebben we een aparte file.
We filteren de punten per jaar en we laden de landbouwgebruikspercelen van dat jaar.
Daarna gebruiken we de `calc_lbg()` functie om de proporties per telcirkel te berekenen.

```{r}
calc_lbg_by_year <- function(punten_df) {
  # Loop over years
  years <- unique(punten_df$jaar)
  out_list <- vector(mode = "list", length = length(years))
  
  for (i in seq_along(years)) {
    year <- years[i]
    
    # Filter by year
    punten_df_year <- punten_df %>% filter(jaar == year)
    lbg_file_year <- path_to_lbg(jaar = year)
    
    out_df_year <- calc_lbg(path = lbg_file_year,
                            punten_sf = punten_df_year)
    
    out_list[[i]] <- out_df_year %>% ungroup() %>% mutate(jaar = year)
  }
  
  return(do.call(rbind.data.frame, out_list)) 
}
```

We groeperen per gewasgroep.
Voor sommige gewasgroepen is er geen data (`NA`).
Er zijn twee categoriÃ«n.

1.  GEWASGROEP is `NA` en LBLHFDTLT is `NA`
2.  GEWASGROEP is `NA` en LBLHFDTLT is Flageolets (voor de boon), Zomerhaver of Winterhaver

In het eerste geval komen de polygonen ook effectief niet met landbouwpercelen overeen.
Die kunnen we dus wegfilteren.
In het tweede geval moeten we de GEWASGROEP manueel aanvullen.

-   Flageolets (voor de boon) $\rightarrow$ Groenten, kruiden en sierplanten
-   Zomerhaver, Winterhaver $\rightarrow$ Granen, zaden en peulvruchten

```{r}
# Add proportion main crop per year
telpunten_2018_2022_hfdtlt_long_tot <- calc_lbg_by_year(telpunten_2018_2022_df)
telpunten_2018_2022_hfdtlt_long <- telpunten_2018_2022_hfdtlt_long_tot %>%
  filter(!is.na(LBLHFDTLT)) %>%
  mutate(GEWASGROEP = case_when(
    is.na(GEWASGROEP) & LBLHFDTLT %in% c("Zomerhaver", "Winterhaver") ~ 
      "Granen, zaden en peulvruchten",
    is.na(GEWASGROEP) & startsWith(LBLHFDTLT, "Flageolets")  ~ 
      "Granen, zaden en peulvruchten",
    TRUE ~ GEWASGROEP
  ))

telpunten_2018_2022_hfdtlt <- telpunten_2018_2022_hfdtlt_long %>%
  group_by(pointid, jaar, GEWASGROEP) %>%
  summarise(area_prop_hfdtlt = sum(area_prop), .groups = "drop") %>%
  pivot_wider(id_cols = c(pointid, jaar), 
              names_from = GEWASGROEP, 
              values_from = area_prop_hfdtlt, 
              values_fill = 0)
```

### Visualisatie

```{r}
telpunten_2018_2022_hfdtlt_long %>%
  group_by(jaar, GEWASGROEP) %>%
  summarise(area_prop_hfdtlt = median(area_prop), .groups = "drop") %>%
  mutate(GEWASGROEP = reorder(factor(GEWASGROEP), area_prop_hfdtlt, sum,
                              decreasing = TRUE)) %>%
  ggplot() +
    geom_bar(aes(x = GEWASGROEP, y = area_prop_hfdtlt, 
                 fill = factor(jaar, ordered = TRUE)), 
             stat = "identity") +
    labs(title = "Oppervlakte-aandeel gewasgroepen", fill = "Jaar",
         x = "", y = "Mediaan proportie over telcirkels") +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
telpunten_2018_2022_hfdtlt_long %>%
  group_by(jaar, GEWASGROEP) %>%
  summarise(mediaan = median(area_prop), 
            gemiddelde = mean(area_prop),
            min = min(area_prop),
            max =  max(area_prop), 
            .groups = "drop") %>%
  mutate(GEWASGROEP = reorder(factor(GEWASGROEP), mediaan, sum,
                              decreasing = TRUE)) %>%
  arrange(jaar, GEWASGROEP) %>%
  kable()
```

### Opmerkingen

-   In percentage of proportie?
-   Compositionele variabele somt niet to 1. Probleem? Herschalen
-   Additieve log ratio transformatie met `alr()` functie van de **compositions** package

## Diversiteit aan hoofdteelten (1)

### Beschrijving

Shannon index als maat voor diversiteit aan hoofdteelten binnen een telcirkel.

### Welk datatype?

Continu.

### Waar verzameld?

Zie oppervlakte-aandeel hoofdteelten (\@ref(opp-hfdtlt)).

### Hoe verzameld?

Zie oppervlakte-aandeel hoofdteelten (\@ref(opp-hfdtlt)).

### Hoe berekend?

We berekenen de Shannon index $H'$ per telcirkel $t$ als volgt:

$$
H'(t) = - \sum_{i=1}^{C(t)}(p_i(t)*\ln[p_i(t)])
$$

Met $p_i(t)$ de proportie van teelt $i$ ($i = 1, ..., C(t)$) in telcirkel $t$.

Voor berekening zie oppervlakte-aandeel hoofdteelten (\@ref(opp-hfdtlt)).

```{r}
telpunten_2018_2022_hfdtlt_div1 <- telpunten_2018_2022_hfdtlt_long_tot %>%
  mutate(calc = area_prop * log(area_prop)) %>%
  group_by(pointid, jaar) %>%
  summarise(shannon_index = -sum(calc), .groups = "drop")
```

### Visualisatie

```{r}
telpunten_2018_2022_hfdtlt_div1 %>%
  ggplot() +
    geom_histogram(aes(x = shannon_index)) +
    labs(title = "Diversiteit aan hoofdteelten (Shannon)",
         x = "Diversiteit aan hoofdteelten per plot (Shannon index)", 
         y = "Frequentie") +
    facet_wrap(~jaar)
```

### Opmerkingen

\

## Diversiteit aan hoofdteelten (2)

### Beschrijving

Aantal hoofdteelten per telcirkel.

### Welk datatype?

Discreet positief.
Count data.

### Waar verzameld?

Zie oppervlakte-aandeel hoofdteelten (\@ref(opp-hfdtlt)).

### Hoe verzameld?

Zie oppervlakte-aandeel hoofdteelten (\@ref(opp-hfdtlt)).

### Hoe berekend?

Tel het aantal verschillende hoofdteelten per plot per jaar.

Op basis van dataframe oppervlakte-aandeel hoofdteelten (\@ref(opp-hfdtlt)).

```{r}
telpunten_2018_2022_hfdtlt_div2 <- telpunten_2018_2022_hfdtlt_long_tot %>%
  count(pointid, jaar)
```

### Visualisatie

```{r}
telpunten_2018_2022_hfdtlt_div2 %>%
  ggplot() +
    geom_bar(aes(x = n)) +
    scale_x_continuous(breaks = seq(0, 20, 2),
                       limits = c(0, NA)) +
    labs(title = "Diversiteit aan hoofdteelten (aantal)",
         x = "Aantal verschillende hoofdteelten per plot", 
         y = "Frequentie") +
    facet_wrap(~jaar)
```

### Opmerkingen

Deze variabele wordt gebruikt als 'gewasdiversiteit' door @klaassen2022. Het is waarschijnlijk niet nuttig om zowel de Shannon index als het aantal te gebruiken in het model.

# Verklarende variabelen van secundair belang

## Regio

### Beschrijving

Regio's van pilootmeetnet.

### Welk datatype?

Categorisch.

### Waar verzameld?

Steekproefdesign.

### Hoe verzameld?

Intersectie landbouwstreek BelgiÃ« met contour Vlaanderen en overlappend met prioritaire gebieden voor akkervogels.
Zie `piloot_perimeters.gpkg`.

### Hoe berekend?

n.v.t.

### Visualisatie

```{r}
perimeters %>%
  rename(regio = Naam) %>%
  filter(regio == "De Moeren") %>%
  ggplot() +
    geom_sf(colour = "firebrick") +
    geom_sf(data = telpunten_2018_2022 %>% 
              filter(regio == "De Moeren")) +
    facet_wrap(~regio) +
    labs(title = "Regio")

perimeters %>%
  rename(regio = Naam) %>%
  filter(regio == "Oostelijke leemstreek") %>%
  ggplot() +
    geom_sf(colour = "firebrick") +
    geom_sf(data = telpunten_2018_2022 %>% 
              filter(regio == "Oostelijke leemstreek")) +
    facet_wrap(~regio)
```

### Opmerkingen

\

## Openheid landschap

### Beschrijving

We beshouwen vier categoriÃ«n van openheid landschap:

-   OL open landschap
-   HOL halfopen landschap
-   HGL halfgesloten landschap
-   GL gesloten landschap

Akkervogelgemeenschappen worden vaak ingedeeld volgens hun affiniteit met open landschap (OLA - Open landschap Akkervogels), half-open landschap (HOLA) en kleinschalig landschap (KLA).
Onder kleinschalig landschap verstaat men een landschap waar de percelen relatief klein zijn en het landschap in sterke mate dooraderd is door hagen, rietkragen en andere lijn- of puntvormige kleine landschapselementen (KLE's).
De manier waarop we openheid van het landschap hebben bepaald laat niet toe om KLA te bepalen zonder bijkomende berekeningen.
KLA zullen een subset zijn van wat wij HOL noemen, met name HOL waar de gemiddelde perceelsgrootte relatief klein is.

Deze variabele verschilt niet over de jaren.

### Welk datatype?

Categorisch.

### Waar verzameld?

??  
DSM (digitaal oppervlakte model - DHMV II Vlaanderen) en DTM (digitaal terrein model) op 5 m resolutie

### Hoe verzameld?

??  
DSM (digitaal oppervlakte model - DHMV II Vlaanderen) en DTM (digitaal terrein model) op 5 m resolutie

### Hoe berekend?

We maken gebruik van het DSM (digitaal oppervlakte model - DHMV II Vlaanderen) en DTM (digitaal terrein model) op 5 m resolutie.
Werkwijze:

-   berekening "canopy height model" (CHM) door verschil te berekenen tussen DSM en DTM. Dit geeft dan hoogte boven het maaiveld (gebouwen, bodem, struiken, ...).
-   berekening van "positive topographic openness" (dit is een waarde tussen 0 en 2 in radians) door voor elke rastercel van het CHM in 8 kijkrichtingen na te gaan wat de gemiddelde hoek is t.o.v. zenith binnen een straal van 300m. Deze hoek geeft aan hoe plat het landschap is. Indien volledig plat is de hoek 90Â° (of 1.57 radians).
-   met dit resultaat de gemiddelde (van de gemiddelde) topografische openheid berekenen in een cirkelvormig landschap rond elke cel met straal 300 m.
-   deze gemiddelden zijn daarna ingedeeld in drie klassen:
    -   OL open landschap (\> 86,5Â°),
    -   HOL halfopen landschap (77,3Â° - 86,5Â°),
    -   HGL halfgesloten landschap (71,6Â° - 77,3Â°)
    -   GL (\< 71,6Â°) gesloten landschap


Met de functie `add_openheid_landschap_to_frame()` kunnen we deze categoriÃ«n toevoegen aan de telpunten.

> Hoe was dit weer? Grootste proportie in telcirkel? nee ...

```{r}
openheid_landschap_file <- path_to_openheid_landschap()
telpunten_2018_2022_openheid <- add_openheid_landschap_to_frame(
  path = openheid_landschap_file,
  punten_sf = telpunten_2018_2022,
  gebied = perimeters)
```

### Visualisatie

```{r}
telpunten_2018_2022_openheid %>%
  ggplot() +
    geom_bar(aes(x = openheid_klasse)) +
    facet_wrap(~regio) +
    labs(x = "Openheid klasse", y = "Aantal telcirkels",
         title = "Openheid landschap")
```

### Opmerkingen

We zijn enkel geÃ¯nteresseerd in OL in De Moeren en OL en HOL in de Oostelijke leemstreek. Voor de modellen kunnen deze eruit gefilterd worden. Verder is het mogelijk dat deze variabele niet wordt meegenomen in het model, maar dat we voor open landschap soorten bijvoorbeeld enkel waarnemingen in OL selecteren HOL voor half-open landschap soorten. 

## Soortbeschermingsplan

### Beschrijving

Zowel binnen kerngebied als zoekzones zijn er soortbeschermende maatregelen (SB BOâs) gelegd (zie kaart VLM BOâs). In theorie waren deze maatregelen vooral bedoeld voor kerngebied, en zal daar een hogere dichtheid (bedekkingsgraad) liggen, maar de VLM heeft het toegelaten om ook in zoekzones deze maatregelen te sluiten (al was dat minder de prioriteit). Daar werd bv. in de Moeren geen rekening mee gehouden, en werden erg veel SB BOâs gelegd, ook omdat dit gebied wÃ©l kerngebied was van plan kiekendief (SBP Grauwe Kiekendief) waardoor er wel veel BOâs gesloten zijn. In de toekomst heeft VLM beloofd om meer/enkel rekening te houden met kerngebied.

Voor het pilootmeetnet namen we de kerngebieden samen als onderzoeksgebied (binnen sbp) en alles hierbuiten beschouwen we als controle (buiten sbp).

### Welk datatype?

Categorisch.

### Waar verzameld?

??  
VLM?

### Hoe verzameld?

??  
VLM?

### Hoe berekend?

```{r}
add_sbp_per_regio <- function(punten_sf, perimeters) {
  
  out_list <- vector(mode = "list", length = length(perimeters$Naam))
  i <- 0
  
  for (r in perimeters$Naam) {
    i <- i + 1
    
    # Filter by region
    punten_df_regio <- punten_sf %>% filter(regio == r)
    sbp_akkervogels_regio <- read_sbp_akkervogels(
      path = path_to_sbp_akkervogels(), 
      gebied = perimeters %>% filter(Naam == r))
    
    telpunten_2018_2022_regio <- add_stratum_sbp(
        punten_sf = punten_df_regio, 
        sbp       = sbp_akkervogels_regio) %>%
      mutate(sbp = ifelse(is_sbp == TRUE, "binnen", "buiten"))
    
    out_list[[i]] <- telpunten_2018_2022_regio
  }
  
  return(do.call(rbind.data.frame, out_list))
}
```

```{r}
telpunten_2018_2022_sbp <- add_sbp_per_regio(telpunten_2018_2022, perimeters)
```

### Visualisatie

```{r}
perimeters %>%
  rename(regio = Naam) %>%
  filter(regio == "De Moeren") %>%
  ggplot() +
    geom_sf(colour = "firebrick", fill = alpha("gold", 0.2)) +
    geom_sf(data = 
              read_sbp_akkervogels(
                path = path_to_sbp_akkervogels(), 
                gebied = perimeters %>% 
                  filter(Naam == "De Moeren")),
            fill = alpha("green", 0.2)) +
    geom_sf(data = telpunten_2018_2022_sbp %>% 
              filter(regio == "De Moeren"),
            aes(colour = sbp)) +

      facet_wrap(~regio) +
    labs(title = "Regio")

perimeters %>%
  rename(regio = Naam) %>%
  filter(regio == "Oostelijke leemstreek") %>%
  ggplot() +
    geom_sf(colour = "firebrick", fill = alpha("gold", 0.2)) +
    geom_sf(data = 
                read_sbp_akkervogels(
                  path = path_to_sbp_akkervogels(), 
                  gebied = perimeters %>% 
                    filter(Naam == "Oostelijke leemstreek")),
              fill = alpha("green", 0.2)) +
    geom_sf(data = telpunten_2018_2022_sbp %>% 
              filter(regio == "Oostelijke leemstreek"),
            aes(colour = sbp)) +
    facet_wrap(~regio)
```

### Opmerkingen

Deze variabele is waarschijnlijk sterk collineair met aandeel beheerovereenkomsten. Bovendien varieert deze variabele niet met jaar, terwijl het beheer wel veranderde over de jaren. Dit is ook in aandeel beheerovereenkomsten opgenomen. Mogelijks is het dus niet nuttig deze variabele op te nemen.

## Status teller

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## Oppervlakte-aandeel kleine landschapselementen

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## Oppervlakte-aandeel biolandbouw

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## Perceelsgroottes

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## X- en Y-coÃ¶rdinaten

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## Inertie beheerovereenkomsten

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## Aantal predatoren

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## Jaar

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

## Telperiode

### Beschrijving

### Welk datatype?

### Waar verzameld?

### Hoe verzameld?

### Hoe berekend?

### Visualisatie

### Opmerkingen

# Random effects

## Telpunt

## Jaar

# Referenties
