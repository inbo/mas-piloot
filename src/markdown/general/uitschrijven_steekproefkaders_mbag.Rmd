---
title: "Uitschrijven steekproefkaders MBAG"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# renv
renv::restore()

# Set up
library(knitr)
library(here)
opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE)
opts_knit$set(root.dir = here())

# Conflicting packages
conflicted::conflicts_prefer(dplyr::filter)
conflicted::conflicts_prefer(dplyr::select)
conflicted::conflicts_prefer(dplyr::lag)

# Packages
library(tidyverse)
library(sf)

# Source

```

# Doel

We willen voor het MBAG project een duidelijk overzicht van het steekproefkader en de steekproef.
Hiervoor schrijven we uit het pilootproject voor de Leemstreek en de Zandleemstreek 4 bestanden weg (als CSV-bestanden):

1.  steekproefkader

2.  gewichten steekproefkader

3.  steekproef

4.  finale steekproef na manuele controle (punten die effectief zijn geteld)

# Leemstreek

We splitsen de Leemstreek op in twee delen aangezien de Oostelijke leemstreek deel uitmaakte van het pilootproject.

## Oostelijke leemstreek

Voor de Oostelijke leemstreek moeten we de variabele SBP opnieuw berekenen omdat we voor het MAS vlaanderen ook andere SBP lagen gebruiken.

We lezen het steekproefkader in van de pilootstudie en selecteren de Oostelijke leemstreek.

```{r}
steekproefkader_piloot <- read_delim(here(
  "data", "processed", "steekproefkader_piloot.tsv"))
steekproefkader_ol_raw <- steekproefkader_piloot %>%
  filter(Naam == "Oostelijke leemstreek")
```

## Westelijke leemstreek

We lezen het steekproefkader in van de Leemstreek. We lezen ook de perimeters van de Oostelijke leemstreek in zodat we de punten van de Westelijke leemstreek kunnen selecteren.

```{r}
# Read in steekproefkader Leemstreek, Zandleemstreek
steekproefkader_zavelberg <- read_delim(here(
  "src", "targets", "mas_steekproef_zavelberg", "output",
  "steekproefkader.tsv")) 

# Select Leemstreek
steekproefkader_leemstreek <- steekproefkader_zavelberg %>%
   filter(Naam == "Leemstreek") 

# Convert to sf
steekproefkader_leemstreek_sf <- steekproefkader_leemstreek %>%
  st_as_sf(coords = c("X", "Y"), crs = st_crs(31370))

# Get perimeter Oostelijke leemstreek
perimeters_piloot <- st_read(here(
  "data", "processed", "piloot_perimeters.gpkg"))

perimeters_ol <- perimeters_piloot %>%
  filter(Naam == "Oostelijke leemstreek")

# Use perimeter to select points Westelijke leemstreek
steekproefkader_wl_sf <- st_difference(steekproefkader_leemstreek_sf,
                                       perimeters_ol)

steekproefkader_wl <- steekproefkader_wl_sf %>%
  mutate(X = st_coordinates(geometry)[,1],
         Y = st_coordinates(geometry)[,2]) %>%
  st_drop_geometry()
```

# Zandleemstreek
