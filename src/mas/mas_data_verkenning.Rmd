---
title: "MAS data verkenning"
author: "Hans Van Calster"
date: "5-1-2022"
bibliography: mas.json
output:
  bookdown::html_document2:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(mapview)
library(here)
library(readxl)
library(gt)
```

```{=html}
<!--
De tellerscode bij max aantallen geeft per jaar aan wie hoofdteller was.
Die drie codes zijn dus professioneel geteld.
De werknemer van UH zit daar niet in met een code, dus als je die ook wil weergeven, dan kan je de punten van de moeren en Leefdal labelen met een UHtellercode, die punten zitten allemaal in het avimap bestand

De avimap database geeft de huidige actuele tellerscode weer, zoals er het voorbije jaar (2021) geteld is geweest.
Het geeft dus enkel aan welke punten er dat jaar, en door wie (pro/vrijwilliger) ze geteld werden.
Als er een teller van een punt geschrapt is (vb door tijdsgebrek, of een vrijwilliger die is weggevallen) dan staat dat punt nu leeg.
Er zijn dus wel punten in die database die ooit een of meerdere keren geteld zijn, maar die nu als "niet geteld" gelabeld staan.
-->
```
```{r inlezen}
# CRS avimap en max-aantallen CRS EPSG:28992 (amesfoort)
# wordt in avimap standaard gebruikt
telpunten_mas <- foreign::read.dbf(
  here("data/mas/avimap_514_0_mas_wg_grauwe_kiekendief_be_telpunten_xy.dbf"),
  as.is = TRUE
  ) %>%
  as_tibble() %>%
  rename(teller_2021 = teller) %>%
  mutate(
    regio = ifelse(is.na(regio), "Vlaanderen - Bilzen", regio),
    type_teller_2021 = case_when(
      teller_2021 %in% c("WVNT00", "JJNN16", "NOVN00") |
        regio == "Vlaanderen - Leefdaal" ~ "professioneel",
      is.na(teller_2021) &
        regio != "Vlaanderen - Leefdaal" ~ "niet geteld in 2021",
      TRUE ~ "vrijwilliger")) %>%
  st_as_sf(coords = c("st_x", "st_y"),
           crs = 28992)

tellingen_leemstreek_moeren <- read_excel(
  here("data/mas/mas_2018_2021 maxaantallen_vlaanderen.xlsx")) %>%
  rename(teller = waarneme) %>%
  left_join(telpunten_mas %>%
              st_drop_geometry() %>%
              select(plotid, regio),
            by = "plotid") %>%
  mutate(
    regio = ifelse(is.na(regio), "Vlaanderen - Bilzen", regio),
    type_teller = case_when(
    teller %in% c("WVNT00", "JJNN16", "NOVN00") |
      (regio == "Vlaanderen - Leefdaal" &
         jaar %in% 2018:2020) ~ "professioneel",
    is.na(teller) &
      !(regio == "Vlaanderen - Leefdaal" &
         jaar %in% 2018:2020) ~ "niet geteld",
    TRUE ~ "vrijwilliger"),
    jaar = as.integer(jaar)) %>%
  st_as_sf(coords = c("x", "y"),
           crs = 28992) 

moeren_leefdaal_shp <- read_sf(
  here("data/mas/mas_leefdaal_moeren_2018-2020.shp"))

moeren_shp <- read_sf(
  here("data/mas/mas_moeren_observatiepunten_buffer200.shp")) %>%
  mutate(area = st_area(.),
         straal = sqrt(area / pi))

leefdaal_shp <- read_sf(
  here("data/mas/mas_leefdaal_observatiepunten_buffer200.shp")) %>%
  mutate(area = st_area(.),
         straal = sqrt(area / pi))

#De punten van UH werden in avimap geïmporteerd
# er is daar in avimap geen tellerscode bij vermeld bij de punten die door UH
# professioneel geteld werden (want ze hebben dat in excel bijgehouden),
#maar die 21 punten mogen dus op professioneel geteld komen
#(voor de periode 2018-2020).
#Hetzelfde voor de punten in Leefdal, die zijn ook in avimap geïmporteerd 
#(voorlopig zijn daar geen vrijwilligers voor aangesproken om die over te nemen)
#, en werden dus ook professioneel geteld voor dezelfde 3 jaar.
```

# MAS-data

## Plan kiekendief

Zie @wiersma2021.

Onderzoek naar prooiaanbod (akkervogels) voor grauwe kiekendief.
Deze MAS-data werden verzameld door vrijwilligers en professionelen (gestuurd door Werkgroep Grauwe Gors en Kenniscentrum akkervogels Grauwe Kiekendief GKA), via Avimap, zowel in de Leemstreek als in de (rand van) de Moeren.
Na 4 jaar tellen werd hierover een eindrapport gepubliceerd, en werd een extra MAS-jaar toegevoegd (2021) om de continuïteit te verzekeren.
Een update met het extra MAS-jaar is in voorbereiding.
Dit is het grootste deel van de MAS-data en is "eigendom" van ANB (plan kiekendief).
<!--, waarbij we nog aan de vrijwillige tellers moeten vragen of ze akkoord zijn dat hun data voor de pilot MAS door INBO mag gebruikt worden.-->

GKA legt geen restricties of voorwaarden op qua gebruik.
<!--Het is wel gangbaar dat de vrijwilligers die voor de data hebben gezorgd nog worden ingelicht en bezwaar kunnen maken als ze dit niet zouden willen.
Johannes zal daarvoor vandaag nog een aanzet geven voor de communicatie naar de vrijwilligers.
We zouden ze dan max een week de tijd geven om te laten weten als hun data niet voor de analyse ter voorbereiding van dit pilootproject zou mogen dienen.
-->

De max aantallen van Leemstreek / Moeren zijn in kader van Plan Kiekendief berekend (dat plan beslaat zowel de Moeren als de Leemstreek), maar de opdrachthouder voor de twee deelgebieden was anders (studiebureau Antea voor de Moeren, en GKA+WGG voor de Leemstreek).
De max aantallen werden geanalyseerd samen met GKA, en zijn vooral relevant voor de Leemstreek, maar de weinige vrijwilligerspunten van de Moeren werden ook meegenomen (omdat Antea dat zelf niet had gedaan en geen bezwaar had).
Dit zijn de max aantallen voor de eerste 4 jaar, zonder de UH tellingen in beschouwing te nemen.
<!--We werken nu aan een update voor die aantallen, met het extra MAS jaar er bij (dus 5 jaar data), en zowel voor de data van de Leemstreek als voor de Moeren (combinatie van vrijwilligerspunten en UH punten)-->

De MAS punten voor plan Kiekendief werden gestratificeerd random uitgestrooid verspreid over het kerngebied van Plan Kiekendief (moeren en leemstreek), dat kerngebied werd door het INBO afgebakend als meest succesvolle gebied voor vestiging van grauwe kiekendief (zie SBP grauwe kiekendief).
Na het uitstrooien van de punten werden de punten vervolgens licht verplaatst (indien nodig) zodat ze vlot bereikbaar zijn en voldoende zicht bieden op het landschap, en eventueel nog bijgesteld na een terreinbezoek door de tellers (controle door coördinator).
Dit alvorens een punt voor een eerste keer werd geteld.
Dus eenmaal geteld, dan werd een punt niet meer verplaatst.

```{r avimap-plan-kiekendief}
telpunten_mas %>%
  filter(!regio %in% c("Vlaanderen - Limburg",
                       "Vlaanderen - Leefdaal",
                       "Vlaanderen - Bilzen")) %>%
  mapview(zcol = "type_teller_2021")
```

```{r tellingen-leemstreek-moeren}
getelde_telpunten_leemstreek_moeren <- tellingen_leemstreek_moeren %>%
  filter(!regio %in% c("Vlaanderen - Limburg",
                       "Vlaanderen - Leefdaal",
                       "Vlaanderen - Bilzen")) %>%
  group_by(jaar, plotid, plotnaam, teller, type_teller) %>%
  summarise(.groups = "drop")

mapview(getelde_telpunten_leemstreek_moeren %>%
          mutate(jaar = as.character(jaar)),
        zcol = c("jaar", "type_teller"))
```

### Limburg

```{r}
telpunten_mas %>%
  filter(regio == "Vlaanderen - Limburg") %>%
  mapview(zcol = "type_teller_2021")
```

Deze punten behoren tot Plan Kiekendief en werden op dezelfde manier uitgestrooid, maar het deelgebied werd later afgevoerd als monitoringsgebied (zie eindrapport).
Ze werden nog nooit geteld (oa omdat een vrijwilligernetwerk in deze gebieden moeilijk realiseerbaar was, en er geen budget was om deze professioneel te laten tellen).

## Plan Leeuwerik

MAS data verzameld door vrijwilligers en professionelen (gestuurd door Werkgroep Grauwe Gors), via Avimap, in de regio Bilzen.
De data is "eigendom" van WGG, project betaald door stad Bilzen.
<!--, waarbij we nog aan de vrijwillige tellers en aan WGG moeten vragen of ze akkoord zijn dat hun data voor de pilot MAS door INBO mag gebruikt worden.--> Dit project loopt nog (minstens) 4 jaar.

```{r kaart-bilzen}
telpunten_mas %>%
  filter(regio == "Vlaanderen - Bilzen") %>%
  mapview(zcol = "type_teller_2021")
```

De punten kunnen niet beschouwd worden als horend bij de Leemstreek, geografisch wel, maar niet als proefopzet.
Ze zijn niet op dezelfde manier als Plan Kiekendief uitgestrooid, maar puur manueel uitgezet verdeeld over het gebied, en telkens op een weg.
<!--Johannes vraagt na of er een achtergronddocument is hiervan.-->

## Akkervogelonderzoek UHasselt

MAS data verzameld door UHasselt in de Moeren en Leefdaal, volledig professioneel geteld.
Dit project is afgelopen, en er werd 3 jaar geteld.
De eigenaar is ANB, van hen en de UH is er goedkeuring om de data van de Moeren op een gelijkaardige manier als de Leemstreek te analyseren.
De tellingen zitten in een excel (werden (nog) niet in avimap gestopt).
<!--We zouden nog aan UH moeten vragen of ze akkoord zijn dat hun data ook voor de pilot MAS door INBO mag gebruikt worden.-->

De coördinaten van de Moeren (21 punten) werden allemaal 3 jaar aan een stuk professioneel geteld door een medewerker van UH.
Dit was een erg dens puntennetwerk, dekkend, met telcirkels die elkaar raakten.
De telcirkels hebben echter een straal van 188 m in plaats van 300 m.
Het jaar ervoor (enkele punten) en het jaar erna (2021) werden een aantal punten overgenomen door de vrijwillige tellers om de continuïteit van een aantal punten te verzekeren.
Daarvoor werden twee punten licht verplaatst.
De oorspronkelijke puntenlijst, en de nieuwe (vrijwillig) getelde puntenlijst zitten ook samen in de avimap dataset.

```{r moeren-uh}
moeren_shp_punten <- moeren_leefdaal_shp %>%
            filter(Area == "Moeren")
mapview(moeren_shp) +
  mapview(moeren_shp_punten, col.regions = "green")
```

```{r}
max_aantallen_moeren_leefdaal <- moeren_leefdaal_shp %>%
  st_join(moeren_shp %>%
            rbind(leefdaal_shp),
          left = FALSE) %>%
  st_drop_geometry() %>%
  group_by(Point, Year, Species, Gebied = Area) %>%
  filter(!is.na(Number)) %>%
  summarise(max_aantal = max(Number),
            .groups = "drop")
```

Een aantal punten van de UH uit de Moeren werden voor 2018 al geteld of in 2021 overgenomen door vrijwilligers.

```{=html}
<!--
Er is geen 1-op-1 koppeling als ik een ruimtelijke join maak tussen de telcirkels en de avimap telpunten. Zie id.moeren 1, 5 en 17. Welke koppeling behoort tot de UH studie?
Het punt id.moeren 1 en 5 werd al voor 2018 geteld (met iets ander coördinaat) dan door de UH, en werd vervolgens in 2021 door diezelfde vrijwilliger verder geteld.
De koppeling is dus id.moeren 1 (VL0532 UH punt in avimap) met VL0049 (vrijwilligerspunt in avimap 45 m verder).
De koppeling id.moeren 5 (VL0536 UH punt in avimap) met VL0084 ( vrijwilligerspunt in avimap 80 m verder).
Het punt id.moeren 17 werd in 2021 nieuw overgenomen door een vrijwilliger, maar op vraag van de teller licht verplaatst, omwille van de zichtbaarheid.
De koppeling hier is id.moeren 17 ( VL0548 UH punt in avimap) met VL0548 (vrijwilligerspunt in avimap 250 m verder).
Gezien de verplaatsing zou ik de koppeling niet maken, en ze als gescheiden (niet continu getelde vrijwilligers-) punten beschouwen.
-->
```
```{r koppeling-avimap-moeren-uh}
# geen perfecte 1 op 1 match (zie id.moeren 1, 5, 17)
moeren_shp %>%
  st_transform(crs = 28992) %>%
  st_join(telpunten_mas,
          suffix = c(".moeren", ".avimap")) %>%
  st_drop_geometry() %>%
  gt()
```

```{r leefdaal-uh}
leefdaal_shp_punten <- moeren_leefdaal_shp %>%
            filter(Area == "Leefdaal")

leefdaal_shp %>%
  mapview() + 
  mapview(leefdaal_shp_punten, col.regions = "green")
```

Leefdal kan beschouwd worden als de Leemstreek (geografisch), maar ook hier werden de punten anders uitgezet (veel denser, door UH), en behoort Leefdal niet tot het kerngebied van Plan Kiekendief.

```{r koppeling-avimap-leefdaal-uh}
# hier wel een 1 op 1 koppeling
leefdaal_shp %>%
  st_transform(crs = 28992) %>%
  st_join(telpunten_mas,
          suffix = c(".leefdaal", ".avimap")) %>%
  st_drop_geometry() %>%
  gt()
```

# Verkenning maximum aantallen

Voor alle soorten zijn er nulwaarnemingen, behalve voor Cetti's zanger (werd twee keer gezien).
Cetti's zanger verwijderen uit dataset of veronderstellen dat de soort niet gezien werd in alle overige jaar x locatie combinaties?

(ref:check-soortenlijst) Overzicht min en max lengte van de soortenlijst en min-max aantal soorten in elk van de telpunten. Cetti's zanger werd verwijderd.

```{r check-soortenlijst}
tellingen_leemstreek_moeren %>%
  st_drop_geometry() %>%
  filter(naam != "cetti's_zanger") %>%
  group_by(regio, jaar, plotid) %>%
  summarise(lengte_soortenlijst_incl0 = n(),
            aantal_soorten = sum(Aantal_max > 0),
            .groups = "drop_last") %>%
  summarise(across(c(lengte_soortenlijst_incl0, aantal_soorten),
                   list(min = min,
                        max = max)),
            .groups = "drop_last") %>%
  gt(caption = "(ref:check-soortenlijst)")
```

(ref:check-telpuntenlijst) Overzicht min - max aantal getelde telpunten per jaar en min - max aantal aanwezige soorten in deze telpunten. Cetti's zanger werd verwijderd.

```{r check-telpuntenlijst}
tellingen_leemstreek_moeren %>%
  st_drop_geometry() %>%
  filter(naam != "cetti's_zanger") %>%
  group_by(regio, jaar, naam) %>%
  summarise(lengte_plotid_incl0 = n(),
            aantal_plotid = sum(Aantal_max > 0),
            .groups = "drop_last") %>%
  summarise(across(c(lengte_plotid_incl0, aantal_plotid),
                   list(min = min,
                        max = max)),
            .groups = "drop_last") %>%
  gt(caption = "(ref:check-telpuntenlijst)")
```

(ref:check-jaren-geteld) Aantal telpunten per regio (n) in functie van het aantal jaren dat het telpunt geteld werd.

```{r check-jaren-geteld}
tellingen_leemstreek_moeren %>%
  st_drop_geometry() %>%
  filter(naam != "cetti's_zanger") %>%
  group_by(regio, plotid) %>%
  summarise(aantal_jaren_geteld = n_distinct(jaar),
            .groups = "drop_last") %>%
  count(regio, aantal_jaren_geteld) %>%
  ungroup() %>%
  gt(caption = "(ref:check-jaren-geteld)")
```

```{r}
tellingen_leemstreek_moeren %>%
  st_drop_geometry() %>%
  filter(naam != "cetti's_zanger") %>%
  pivot_wider(id_cols = c(jaar, regio, plotid),
              names_from = naam, 
              values_from = Aantal_max) -> tellingen_breed
```

```{r}
tellingen_leemstreek_moeren %>%
  st_drop_geometry() %>%
  filter(naam != "cetti's_zanger") %>%
  group_by(regio, jaar, plotid) %>%
  filter(Aantal_max > 0) %>%
  summarise(aantal_soorten = n(),
            exp_shannon =
              exp(
                -sum(
                  Aantal_max / sum(Aantal_max) *
                       log(Aantal_max / sum(Aantal_max))
                  )
                ),
            .groups = "drop_last"
            ) -> diversiteit

diversiteit %>%
  ggplot() +
  geom_boxplot(aes(x = regio, y = aantal_soorten,
                   fill = factor(jaar)))


diversiteit %>%
  ggplot() +
  geom_boxplot(aes(x = regio, y = exp_shannon,
                   fill = factor(jaar)))
```

```{r eval=FALSE}
pca_hellinger <- princomp(
  vegan::decostand(tellingen_breed[, -(1:3)],
                   method = "hellinger"))

plot(pca_hellinger)
```

```{r eval=FALSE}
unique(tellingen_leemstreek_moeren$naam) %>%
  as_tibble() %>%
  rename(naam = value) %>%
  write_excel_csv2("data/mas/soortenlijst.csv")
```

# Verklarende variabelen

Voedsel (winter en zomer) - Veiligheid (dekking) - Nestgelegenheid

Landgebruik - lokaal

Voorteelt, hoofdteelt, nateelt

Ecoregelingen

Beheerovereenkomsten

Bio vs niet bio

Gewasbeschermingsmiddelen

Bemestingsniveau

Landgebruik - ruimer landschap

Perceelsgrootte

# Vogelkenmerken

-   Akkervogels

    -   open Landschappen Akkervogels (OLA's)
    -   Kleinschalige Landschappen Akkervogels (KLA's)

# Telprotocol

Is er gewerkt met een vaste lijst van soorten?

In principe worden vogels die buiten de telcirkel vallen uit de data weggeknipt.

Naast vogelsoort en aantal individuen ook extra indicatoren die relevant zijn voor microbeheermonitoringschaal:

-   stapelvoedselindicatoren: zaadbeschikbaarheid / insectenabundantie

cf [@roodbergen2011]

# Rapport outline

1.  Inleiding

2.  Overzicht lopende meetnetten Vlaanderen

    1.  Projecten

        -   ABV

        -   MAS

            -   Plan kiekendief
            -   Plan Leeuwerik
            -   Akkervogelonderzoek UHasselt

    2.  Veldprotocol

        -   telling vogels

            -   ABV
            -   MAS

        -   andere indicatoren

    3.  Steekproefontwerp

        -   ABV
        -   MAS

3.  Aanpak akkervogel meetnetten in buitenland

    -   Lessons learned MAS Nederland
    -   UK
    -   ...

4.  Ontwerp inzameling pilootgegevens 2022 - 2023

    -   Informatiebehoefteanalyse

        -   Wat weten we al?
        -   Wat willen we nog weten?

    -   Selectie telpunten in functie van informatiebehoefte

5.  Analyse beschikbare ABV en MAS gegevens akkervogels

    -   Berekening verklarende variabelen (GIS analyse)
    -   Resultaten

6.  Ontwerp meetnet voor akkervogels Vlaanderen

    -   Informatiebehoefteanalyse

    -   Ontwerp van de gegevensinzameling

        -   Afbakening steekproefkader
        -   Stratificatie / inclusiekansen
        -   Steekproefgrootteberekening
        -   Allocatie steekproefgrootte over strata
        -   Steekproeftrekking

    -   Plannen van de gegevensanalyse

    -   Plannen van de rapportering en communicatie

    -   Implementatie en kwaliteitszorg

7.  Discussie

8.  Conclusies

# Referenties
